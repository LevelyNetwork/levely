LEVELY - PASOS PARA EL MVP (Next.js 15 + Supabase + Prisma)
==========================================================

Objetivo
--------
Construir un MVP funcional en un único proyecto Next.js 15 (App Router) desplegado en Vercel que use Supabase (Postgres + Auth + Storage + Realtime) y Prisma 5.20+. El MVP debe permitir:
- Registro/login con OAuth (Google/GitHub) vía Supabase Auth.
- Creación de usuarios enriquecidos (bio, foto, XP total) tras el onboarding.
- Creación de publicaciones (texto + imagen opcional) mediante Server Actions.
- Feed ordenado por fecha con likes en tiempo real (Supabase Realtime o Prisma Pulse).
- Asignación de XP (+100 crear post, +1 like recibido) y cálculo de nivel simple.
- UI responsive construida con Tailwind + shadcn/ui + Radix.

Stack técnico mínimo
--------------------
- Next.js 15 App Router + Server Actions (sin API separada).
- Prisma 5.20+ conectado a Supabase Postgres.
- Supabase Auth/Storage/Realtime desde el SDK oficial.
- Tailwind CSS + shadcn/ui + Radix UI para componentes.
- pnpm o bun como package manager, Playwright + Vitest para pruebas.

Roadmap de implementación
-------------------------
1) **Inicialización del proyecto (Día 0-1)**
   - Crear repo con la estructura descrita en `estructura_carpetas_frontend_backend.txt`.
   - Configurar Tailwind, shadcn/ui y Radix; definir tokens de diseño básicos.
   - Crear carpeta `lib/repositories` que expondrá funciones puras sobre Prisma para separar la lógica de acceso a datos de las Server Actions.
   - Añadir eslint/prettier y scripts (`pnpm lint`, `pnpm test`, `pnpm format`).

2) **Supabase + Prisma (Día 1-2)**
   - Crear proyecto Supabase: habilitar Auth (Google, GitHub), Storage, Realtime.
   - Añadir `.env.local` con `NEXT_PUBLIC_SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, `DATABASE_URL`.
   - Definir `schema.prisma` con entidades MVP: UserProfile, Post, Like, XpEvent, Notification.
   - Ejecutar `pnpm prisma migrate dev` y `pnpm prisma generate`. Crear script `scripts/seed.ts`.

3) **Auth y onboarding (Día 2-3)**
   - Configurar Supabase Auth helpers (middleware + Server Components) para proteger rutas.
   - Crear Server Action `completeProfile` para guardar bio/foto y setear XP inicial.
   - Implementar UI onboarding con shadcn/ui y subida de foto a Supabase Storage.

4) **Modelo XP y niveles (Día 3-4)**
   - Crear módulo `lib/xp.ts` con fórmula `level = 1 + floor(sqrt(xp / 100))`.
   - Server Action `awardXp(userId, points, reason)` que inserta en `XpEvent` y actualiza totales.
   - Añadir tests unitarios para la fórmula y las reglas de XP.

5) **Publicaciones y likes (Día 4-6)**
   - Server Actions `createPost`, `toggleLike` usando Prisma y validaciones Zod apoyadas en los repositorios (`PostRepository`, `LikeRepository`).
   - Subida de imagen opcional (Supabase Storage o Vercel Blob) con URLs públicas.
   - Feed en App Router (segmento `(dashboard)`) que usa Server Components para listar posts ordenados.

6) **Realtime y notificaciones (Día 6-7)**
   - Suscribirse a canales Supabase Realtime (tabla `Like`) para actualizar conteos sin recargar.
   - Opcional: enviar notificaciones a Supabase `Notification` table y mostrarlas en UI; encapsular queries en `NotificationRepository` para reutilizar en Server Actions y cron jobs.

7) **UI y UX (Día 7-9)**
   - Limpiar componentes en `components/` (cards, forms, modales) usando shadcn/ui.
   - Estado optimista para crear post y likes; skeleton loaders con Tailwind.
   - A11y básica gracias a Radix + pruebas con Storybook/Chromatic opcional.

8) **Pruebas y calidad (Día 8-10)**
   - Tests unitarios (Vitest) para helpers (XP, validaciones).
   - Tests de integración para Server Actions (mocks de Prisma/Supabase).
   - Playwright E2E: login demo, crear post, dar like, ver XP actualizado.

9) **Despliegue en Vercel (Día 10-11)**
   - Conectar repo a Vercel, configurar env vars (supabase keys, DATABASE_URL, STORAGE_BUCKET_URL).
   - Habilitar Preview + Production; forzar `pnpm prisma migrate deploy` en `vercel build`.
   - Revisar logs y quotas (Auth/Realtime) tras cada deploy.

10) **Smoke tests y checklist (Día 11-12)**
    - Ejecutar Playwright contra producción (Vercel) validando Auth, creación de post, likes realtime.
    - Confirmar seeds en Supabase y limpiar datos de prueba.
    - Documentar comandos clave, setup Supabase, credenciales OAuth y cómo regenerar componentes shadcn.

Modelo de datos mínimo en Prisma
--------------------------------
- `UserProfile`: id (uuid), email, username, bio, photoUrl, xp, level, createdAt.
- `Post`: id, authorId (fk → UserProfile), content, imageUrl, createdAt.
- `Like`: id, postId, userId, createdAt (unique compuesto post+user).
- `XpEvent`: id, userId, amount, reason, createdAt.
- `Notification` (opcional en MVP): id, userId, type, message, read, createdAt.

Acciones clave
--------------
- `createPost(data)` → valida con Zod, crea post, guarda imagen, +100 XP al autor.
- `toggleLike(postId)` → inserta/elimina Like, suma XP al autor cuando se crea.
- `getFeed()` → Prisma query con include author y likesCount expuesta vía `FeedRepository`.
- `useRealtimeLikes(postId)` → hook cliente usando Supabase Realtime.

Pruebas recomendadas
--------------------
- Vitest: `xp.test.ts`, `posts.test.ts` (validaciones de Server Actions).
- Playwright: flujo login OAuth (mock), creación de post, like, ver XP.
- Smoke test posterior al deploy usando GitHub Actions + Playwright en modo headless.

Checklist (sí/no)
-----------------
[ ] Proyecto Next.js 15 creado con Tailwind + shadcn/ui + Radix inicializados.
[ ] Supabase configurado (Auth, Storage, Realtime) y variables definidas.
[ ] `schema.prisma` + migraciones aplicadas en Supabase.
[ ] Server Actions para onboarding, posts, likes y XP.
[ ] Hooks/SDK para Realtime funcionando en el feed.
[ ] Upload de imágenes operativo (Storage/Blob) con validación.
[ ] Tests unitarios (Vitest) y E2E (Playwright) verdes.
[ ] Deploy automático en Vercel con migraciones Prisma.
[ ] Smoke test post-deploy que valida conexión con la base de datos.

Próximos pasos post-MVP
-----------------------
- Agregar Supabase RLS avanzada y Clerk como alternativa de Auth si se necesita multi-org.
- Misiones/logros con reglas configurables en Prisma + dashboards.
- Paginación infinita y ranking por XP usando Prisma + caché.
- Auditoría y observabilidad (Vercel Analytics, Logflare, OpenTelemetry).
- Feature flags para experimentos (LaunchDarkly o Supabase Feature Flags beta).

Notas útiles
------------
- Controlar el pool de conexiones: evita funciones Edge en acciones que usen Prisma.
- Supabase gratis cubre hasta 500 MB; limpia datos de prueba regularmente.
- Para Realtime de alta demanda considerar Prisma Pulse (beta) o Supabase Channels dedicados.
- Mantén `.env.local` fuera de git y usa `.env.local.example` para documentación.

Fin del documento.
